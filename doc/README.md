# 自用各类脚本集合

## 项目概述

本项目是一个自动化脚本集合，用于执行日常定时任务、签到等自动化操作。项目基于 Python 和青龙面板框架，提供了一系列实用工具和脚本，可以帮助用户自动完成各种重复性任务。

### 主要特点

- **模块化设计**：核心功能被拆分为独立模块，便于维护和扩展
- **统一配置管理**：支持从 YAML 文件和环境变量加载配置
- **完善的错误处理**：包含异常捕获和日志记录
- **消息通知功能**：支持任务执行结果通知
- **青龙面板集成**：可与青龙面板无缝对接

## 目录结构

```
项目根目录/
├── config/             # 配置文件目录
│   └── app_config.yaml.sample  # 配置文件示例
├── doc/                # 文档目录
│   └── signin_type_1.md  # 微信小程序签到脚本文档
├── scripts/            # 脚本文件目录
│   └── signin_type_1.py  # 微信小程序签到脚本
├── utils/              # 工具模块目录
│   ├── __init__.py      # 包初始化文件
│   ├── config.py        # 配置加载模块
│   ├── notify_utils.py  # 消息通知工具
│   └── qlapi.py         # 青龙面板 API 客户端
└── README.md           # 项目说明文档
```

## 功能模块

### 1. 配置管理 (`utils/config.py`)

提供了灵活的配置加载机制，支持从多种来源加载配置：

- **YAML 文件**：从 YAML 配置文件加载配置
- **环境变量**：从系统环境变量加载配置，支持嵌套结构

配置模块采用工厂模式设计，可以轻松扩展新的配置源。

### 2. 消息通知 (`utils/notify_utils.py`)

提供统一的消息推送接口，用于发送任务执行结果通知。

### 3. 青龙面板 API (`utils/qlapi.py`)

封装了与青龙面板交互的 API 客户端，支持：

- 获取和更新环境变量
- 身份验证和令牌管理
- 请求重试和错误处理

### 4. 微信小程序自动签到 (`scripts/signin_type_1.py`)

实现了微信小程序的自动登录和签到功能：

- 支持多个微信小程序
- 支持多账号配置
- 自动处理登录令牌
- 完整的错误处理和日志记录

## 配置说明

### 配置文件

项目使用 YAML 格式的配置文件，位于 `config/app_config.yaml`。您需要根据示例配置文件 `app_config.yaml.sample` 创建自己的配置文件。

配置文件包含以下主要部分：

1. **common**：通用配置
   - `qinglong`：青龙面板配置
   - `redis`：Redis 配置

2. **signin_type_1**：微信小程序签到配置
   - `app_configs`：应用配置
   - `user_infos`：用户信息

### 环境变量配置

除了 YAML 文件外，项目还支持从环境变量加载配置。环境变量名称使用双下划线 `__` 分隔层级结构，例如：

```
APP_CONFIG__DATABASE__HOST=localhost
```

将被转换为：

```json
{
  "app_config": {
    "database": {
      "host": "localhost"
    }
  }
}
```

## 使用方法

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置

复制配置文件示例并修改：

```bash
cp config/app_config.yaml.sample config/app_config.yaml
```

根据需要修改配置文件。

### 3. 运行脚本

```bash
python scripts/signin_type_1.py
```

## 扩展指南

### 添加新脚本

1. 在 `scripts/` 目录下创建新的脚本文件
2. 在 `doc/` 目录下创建对应的文档文件
3. 在 `config/app_config.yaml` 中添加相应的配置项

### 添加新的配置源

1. 在 `utils/config.py` 中创建新的配置源类，继承 `ConfigSourceBase`
2. 实现 `load_config()` 方法
3. 使用 `set_config_source()` 函数切换到新的配置源

## 注意事项

1. **安全性**
   - 请妥善保管配置文件，不要泄露敏感信息
   - 建议将 `app_config.yaml` 加入 `.gitignore`

2. **运行频率**
   - 请合理设置脚本运行频率，避免对目标服务器造成过大压力

3. **错误处理**
   - 所有脚本都应包含适当的错误处理和日志记录
   - 建议配置通知功能接收错误通知

## 未来计划

本项目将持续添加新的自动化脚本，包括但不限于：

- 更多平台的自动签到
- 数据同步工具
- 系统监控脚本
- 自动化测试工具

## 贡献指南

欢迎贡献代码或提出建议。请确保您的代码符合项目的代码风格和最佳实践。

## 许可证

本项目采用 MIT 许可证。