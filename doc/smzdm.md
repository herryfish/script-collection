# 什么值得买自动化脚本

## 功能说明

本脚本实现了什么值得买网站/APP的自动化操作，包括以下功能：

- **自动签到**：每日自动完成签到并获取签到奖励
- **任务完成**：自动完成签到页面的日常任务
- **活动任务**：自动完成特定活动页面的任务
- **抽奖功能**：自动完成免费抽奖
- **额外奖励**：自动领取连续签到和任务完成的额外奖励

## 环境要求

- Python 3.x
- 依赖包：
  - requests
  - loguru
  - urllib3

## 配置说明

配置文件支持两种方式：
1. YAML文件配置（默认）
2. 环境变量配置

### YAML文件配置

在 `config/app_config.yaml` 中配置以下信息：

```yaml
# 什么值得买
smzdm:
  # 用户信息
  user_infos:
    - name: "用户名"  # 用户名称，用于日志显示
      cookie: "COOKIE字符串"  # 用户Cookie
  # 应用配置
  app_configs:
    # 活动页面ID列表
    topic_page_list:
      - "活动页面ID1"  # 活动描述1
      - "活动页面ID2"  # 活动描述2
    # 抽奖ID列表
    lottery_list:
      - "抽奖ID1"  # 抽奖描述1
      - "抽奖ID2"  # 抽奖描述2
    # 活动ID列表
    activity_list:
      - "活动ID1"
      - "活动ID2"
```

### 配置项说明

1. `user_infos`: 用户信息列表，支持多账号配置
   - `name`: 用户名称，用于日志显示
   - `cookie`: 用户的Cookie字符串，用于身份验证
2. `app_configs`: 应用相关配置
   - `topic_page_list`: 活动页面ID列表，脚本会访问这些页面并收集其中的活动任务和抽奖任务
   - `lottery_list`: 抽奖ID列表，脚本会直接参与这些抽奖活动
   - `activity_list`: 活动ID列表，脚本会直接完成这些活动的任务

### 环境变量配置

除了YAML文件外，脚本还支持从环境变量加载配置。环境变量名称使用双下划线 `__` 分隔层级结构，例如：

```
SMZDM__USER_INFOS__0__NAME=用户名
SMZDM__USER_INFOS__0__COOKIE=COOKIE字符串
SMZDM__APP_CONFIGS__TOPIC_PAGE_LIST__0=活动页面ID1
SMZDM__APP_CONFIGS__TOPIC_PAGE_LIST__1=活动页面ID2
SMZDM__APP_CONFIGS__LOTTERY_LIST__0=抽奖ID1
SMZDM__APP_CONFIGS__ACTIVITY_LIST__0=活动ID1
```

这种配置方式特别适合容器化部署环境。

## Cookie获取方法

1. 使用Chrome浏览器登录什么值得买网站(https://www.smzdm.com/)
2. 按F12打开开发者工具，切换到「Network」标签
3. 刷新页面，在请求列表中找到任意一个请求
4. 在请求头中找到「Cookie」字段，复制其完整内容

## 使用方法

### 方法一：直接运行

1. 复制配置文件示例并修改：
   ```bash
   cp config/app_config.yaml.sample config/app_config.yaml
   ```

2. 编辑配置文件，填入实际的配置信息

3. 运行脚本：
   ```bash
   python scripts/smzdm.py
   ```

### 方法二：在青龙面板中运行

1. 将脚本添加到青龙面板

2. 配置环境变量或在青龙面板中创建配置文件

3. 创建定时任务，建议每天运行一次

## 脚本工作流程

1. **签到流程**：
   - 获取token
   - 执行签到
   - 获取签到奖励
   - 获取额外奖励

2. **任务完成流程**：
   - 获取任务列表
   - 遍历任务列表，完成可执行的任务
   - 领取任务完成奖励

3. **活动任务流程**：
   - 访问活动页面，收集活动ID和抽奖ID
   - 完成活动任务
   - 参与抽奖活动

## 注意事项

1. **安全性**
   - 请妥善保管Cookie信息，不要泄露给他人
   - 建议将配置文件加入 `.gitignore`

2. **运行频率**
   - 建议每天运行一次，过于频繁的请求可能导致账号异常

3. **错误处理**
   - 脚本内置了错误重试机制，可以应对临时网络问题
   - 日志文件保存在 `logs/smzdm_debug.log`

## 常见问题

1. **Cookie失效**
   - 症状：脚本运行时提示登录失败或权限不足
   - 解决方法：重新获取Cookie并更新配置

2. **任务完成失败**
   - 症状：某些任务显示无法完成
   - 解决方法：部分任务需要人工操作，脚本只能完成自动化的部分

3. **抽奖次数不足**
   - 症状：显示抽奖次数已用完
   - 解决方法：免费抽奖次数有限，用完后需等待刷新